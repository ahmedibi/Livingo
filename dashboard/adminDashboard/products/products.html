<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/iconify/3.1.1/iconify.min.js"
      integrity="sha512-oQ1yQwSEIc9CTcK7pffEyS8fxom2iUWQrALk3j3+wfdSDjQ77EZbzGMGe2ZYmfoC8M9vR47apbS1ZYbW05y/pg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <link rel="stylesheet" href="../sidebar/sidebar.css" />

    <style>
      .search-box {
        position: relative;
      }
      .search-box input {
        padding-left: 2.2rem;
      }
      .search-box i {
        position: absolute;
        top: 50%;
        left: 10px;
        transform: translateY(-50%);
        color: gray;
      }
      .filters-row .col-md-3 {
        display: flex;
        flex-direction: column;
      }
      .filters-row label {
        font-weight: 500;
      }
      #sideBar.closed {
        width: 80px;
      }

      #sideBar.closed .menu a p,
      #sideBar.closed .logo span {
        display: none;
      }
    </style>
  </head>

  <body>
    <!-- Sidebar -->
    <section id="sideBar">
      <div class="row"></div>
      <button class="sidebar-toggler">â˜°</button>
      <a href="../../../index.html" class="logo">
        <svg
          width="38"
          height="38"
          viewBox="0 0 38 38"
          class="livingo-icon"
          aria-hidden="true"
        >
          <ellipse cx="19" cy="13" rx="10" ry="7" fill="#cdbc92" />
          <rect x="17" y="13" width="4" height="13" rx="2" fill="#a0804d" />
          <ellipse cx="19" cy="31" rx="7" ry="3" fill="#59442a" />
          <ellipse
            class="lamp-glow"
            cx="19"
            cy="20"
            rx="12"
            ry="4"
            fill="#edd67d"
            opacity="0.14"
          />
        </svg>
        <span class="livingo-word">Living<span class="cushion-o">o</span></span>
      </a>
      <ul class="menu">
        <li>
          <a href="../index/admin.html" class="active">
            <svg width="30" height="30" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5z"
              />
            </svg>
            <p>Dashboard</p>
          </a>
        </li>
        <li>
          <a href="../products/products.html">
            <svg width="30" height="30" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
              />
            </svg>
            <p>Products</p>
          </a>
        </li>
        <li>
          <a href="../users/users.html">
            <svg width="30" height="30" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"
              />
            </svg>
            <p>Users</p>
          </a>
        </li>
        <li>
          <a href="../sellers/sellers.html">
            <svg width="30" height="30" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"
              />
              <path
                fill-rule="evenodd"
                d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z"
              />
              <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
            </svg>
            <p>Seller</p>
          </a>
        </li>
        <li>
          <a href="../orders/orders.html">
            <svg width="30" height="30" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zm3.915 10L3.102 4h10.796l-1.313 7h-8.17zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"
              />
            </svg>
            <p>Orders</p>
          </a>
        </li>
        <li class="logout">
          <a id="logOut">
            <svg width="30" height="30" fill="currentColor" viewBox="0 0 16 16">
              <path
                fill-rule="evenodd"
                d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"
              />
              <path
                fill-rule="evenodd"
                d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"
              />
            </svg>
            <p>Logout</p>
          </a>
        </li>
      </ul>
    </section>

    <!-- Main Content -->
    <main id="mainContent" class="main-content">
      <h2 class="mb-4">Product Management</h2>

      <!-- Filters -->
      <div
        class="row g-3 mb-4 p-3 bg-light rounded shadow-sm align-items-center filters-row"
      >
        <div class="col-md-3">
          <input
            type="text"
            id="searchInput"
            class="form-control"
            placeholder="Search by name or id"
          />
        </div>
        <div class="col-md-3">
          <select id="categoryFilter" class="form-select">
            <option value="all">All Categories</option>
            <option value="living room">Living Room</option>
            <option value="bedroom">Bedroom</option>
            <option value="dining room">Dining Room</option>
            <option value="office">Office</option>
            <option value="outdoor">Outdoor</option>
            <option value="lighting & decor">Lighting & Decor</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="priceRange" class="form-label d-block">
            Max Price: <span id="priceValue">2000</span>
          </label>
          <input
            type="range"
            id="priceRange"
            min="0"
            max="3000"
            value="2000"
            class="form-range"
          />
        </div>
      </div>

      <!-- Products Table -->
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Product</th>
              <th>Category</th>
              <th>Price</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="productTableBody"></tbody>
        </table>
      </div>
    </main>

    <!-- Scripts -->
    <script src="../../bootstrap-5.3.7-dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/sidebar.js"></script>
    <script>
      // Render Products
      function renderProducts(products = null) {
        let allProducts = JSON.parse(localStorage.getItem("products")) || [];
        const tableBody = document.getElementById("productTableBody");
        tableBody.innerHTML = "";

        (products || allProducts).forEach((p) => {
          tableBody.innerHTML += `
            <tr>
              <td>
                <img src="../../../assets/${p.images[0]}" alt="${p.name}"
                  style="width:40px;height:40px;object-fit:cover;border-radius:4px;"/>
                ${p.name}<br><small>#${p.id}</small>
              </td>
              <td>${p.category}</td>
              <td>${p.price} ${p.currency || "EGP"}</td>
              <td>${p.stock}</td>
              <td>
                <span class="badge bg-${p.stock > 0 ? "success" : "danger"}">
                  ${p.stock > 0 ? "active" : "out of stock"}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-primary" onclick="editProduct('${
                  p.id
                }')">
                  <i class="fa-solid fa-pen-to-square"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteProduct('${
                  p.id
                }')">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
        });
      }

      function deleteProduct(productId) {
        let products = JSON.parse(localStorage.getItem("products")) || [];
        products = products.filter((p) => p.id !== productId);
        localStorage.setItem("products", JSON.stringify(products));
        applyFilters();
      }

      function editProduct(productId) {
        window.location.href = `editproduct.html?id=${productId}`;
      }

      function applyFilters() {
        let searchVal = searchInput.value.toLowerCase();
        let categoryVal = categoryFilter.value.toLowerCase();
        let priceVal = parseInt(priceRange.value);

        let products = JSON.parse(localStorage.getItem("products")) || [];

        let filtered = products.filter((p) => {
          let matchSearch =
            p.id.toLowerCase().includes(searchVal) ||
            p.name.toLowerCase().includes(searchVal);

          let mainCategory = p.category.split(" - ")[0].toLowerCase();
          let matchCategory =
            categoryVal === "all" || mainCategory === categoryVal;

          let matchPrice = p.price <= priceVal;

          return matchSearch && matchCategory && matchPrice;
        });

        renderProducts(filtered);
      }

      document
        .getElementById("searchInput")
        .addEventListener("input", applyFilters);
      document
        .getElementById("categoryFilter")
        .addEventListener("change", applyFilters);
      document.getElementById("priceRange").addEventListener("input", () => {
        document.getElementById("priceValue").textContent =
          priceRange.value + " EGP";
        applyFilters();
      });

      document.addEventListener("DOMContentLoaded", () => {
        renderProducts();
      });

      const sideBar = document.getElementById("sideBar");
      const toggler = document.querySelector(".sidebar-toggler");

      toggler.addEventListener("click", () => {
        sideBar.classList.toggle("closed");
      });
    </script>
  </body>
</html>
