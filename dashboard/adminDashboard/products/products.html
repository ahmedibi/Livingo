<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/iconify/3.1.1/iconify.min.js"
      integrity="sha512-oQ1yQwSEIc9CTcK7pffEyS8fxom2iUWQrALk3j3+wfdSDjQ77EZbzGMGe2ZYmfoC8M9vR47apbS1ZYbW05y/pg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <link rel="stylesheet" href="../sidebar/sidebar.css" />

    <style>
      .search-box {
        position: relative;
      }
      .search-box input {
        padding-left: 2.2rem;
      }
      .search-box i {
        position: absolute;
        top: 50%;
        left: 10px;
        transform: translateY(-50%);
        color: gray;
      }
      .filters-row .col-md-3 {
        display: flex;
        flex-direction: column;
      }
      .filters-row label {
        font-weight: 500;
      }
      #sideBar.closed {
        width: 80px;
      }

      #sideBar.closed .menu a p,
      #sideBar.closed .logo span {
        display: none;
      }
    </style>
  </head>

  <body>
    <!-- Sidebar -->
    <section id="sideBar">
      <div class="row"></div>
      <button class="sidebar-toggler">â˜°</button>
      <a href="../../../index.html" class="logo">
        <svg
          width="38"
          height="38"
          viewBox="0 0 38 38"
          class="livingo-icon"
          aria-hidden="true"
        >
          <ellipse cx="19" cy="13" rx="10" ry="7" fill="#cdbc92" />
          <rect x="17" y="13" width="4" height="13" rx="2" fill="#a0804d" />
          <ellipse cx="19" cy="31" rx="7" ry="3" fill="#59442a" />
          <ellipse
            class="lamp-glow"
            cx="19"
            cy="20"
            rx="12"
            ry="4"
            fill="#edd67d"
            opacity="0.14"
          />
        </svg>
        <span class="livingo-word">Living<span class="cushion-o">o</span></span>
      </a>
      <ul class="menu">
        <li>
          <a href="../index/admin.html">
            <i class="fas fa-home"></i>
            <p>Dashboard</p>
          </a>
        </li>
        <li>
          <a href="../products/products.html" class="active">
            <i class="fas fa-box-open"></i>
            <p>Products</p>
          </a>
        </li>
        <li>
          <a href="../users/users.html">
            <i class="fas fa-user"></i>
            <p>Users</p>
          </a>
        </li>
        <li>
          <a href="../sellers/sellers.html">
            <i class="fas fa-users"></i>
            <p>Sellers</p>
          </a>
        </li>
        <li>
          <a href="../orders/orders.html">
            <i class="fas fa-shopping-cart"></i>
            <p>Orders</p>
          </a>
        </li>
        <li class="logout">
          <a id="logOut" style="cursor: pointer">
            <i class="fas fa-sign-out-alt"></i>
            <p>Logout</p>
          </a>
        </li>
      </ul>
    </section>

    <!-- Main Content -->
    <main id="mainContent" class="main-content">
      <h2 class="mb-4">Product Management</h2>

      <!-- Filters -->
      <div
        class="row g-3 mb-4 p-3 bg-light rounded shadow-sm align-items-center filters-row"
      >
        <div class="col-md-3">
          <input
            type="text"
            id="searchInput"
            class="form-control"
            placeholder="Search by name or id"
          />
        </div>
        <div class="col-md-3">
          <select id="categoryFilter" class="form-select">
            <option value="all">All Categories</option>
            <option value="living room">Living Room</option>
            <option value="bedroom">Bedroom</option>
            <option value="dining room">Dining Room</option>
            <option value="office">Office</option>
            <option value="outdoor">Outdoor</option>
            <option value="lighting & decor">Lighting & Decor</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="priceRange" class="form-label d-block">
            Max Price: <span id="priceValue">2000</span>
          </label>
          <input
            type="range"
            id="priceRange"
            min="0"
            max="3000"
            value="2000"
            class="form-range"
          />
        </div>
      </div>

      <!-- Products Table -->
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Product</th>
              <th>Category</th>
              <th>Price</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="productTableBody"></tbody>
        </table>
      </div>
    </main>

    <!-- Scripts -->
    <script src="../../bootstrap-5.3.7-dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/sidebar.js"></script>
    <script>
      // Render Products
      function renderProducts(products = null) {
        let allProducts = JSON.parse(localStorage.getItem("products")) || [];
        const tableBody = document.getElementById("productTableBody");
        tableBody.innerHTML = "";

        (products || allProducts).forEach((p) => {
          tableBody.innerHTML += `
            <tr>
              <td>
                <img src="../../../assets/${p.images[0]}" alt="${p.name}"
                  style="width:40px;height:40px;object-fit:cover;border-radius:4px;"/>
                ${p.name}<br><small>#${p.id}</small>
              </td>
              <td>${p.category}</td>
              <td>${p.price} ${p.currency || "EGP"}</td>
              <td>${p.stock}</td>
              <td>
                <span class="badge bg-${p.stock > 0 ? "success" : "danger"}">
                  ${p.stock > 0 ? "active" : "out of stock"}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-primary" onclick="editProduct('${
                  p.id
                }')">
                  <i class="fa-solid fa-pen-to-square"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteProduct('${
                  p.id
                }')">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
        });
      }

      function deleteProduct(productId) {
        let products = JSON.parse(localStorage.getItem("products")) || [];
        products = products.filter((p) => p.id !== productId);
        localStorage.setItem("products", JSON.stringify(products));
        applyFilters();
      }

      function editProduct(productId) {
        window.location.href = `editproduct.html?id=${productId}`;
      }

      function applyFilters() {
        let searchVal = searchInput.value.toLowerCase();
        let categoryVal = categoryFilter.value.toLowerCase();
        let priceVal = parseInt(priceRange.value);

        let products = JSON.parse(localStorage.getItem("products")) || [];

        let filtered = products.filter((p) => {
          let matchSearch =
            p.id.toLowerCase().includes(searchVal) ||
            p.name.toLowerCase().includes(searchVal);

          let mainCategory = p.category.split(" - ")[0].toLowerCase();
          let matchCategory =
            categoryVal === "all" || mainCategory === categoryVal;

          let matchPrice = p.price <= priceVal;

          return matchSearch && matchCategory && matchPrice;
        });

        renderProducts(filtered);
      }

      document
        .getElementById("searchInput")
        .addEventListener("input", applyFilters);
      document
        .getElementById("categoryFilter")
        .addEventListener("change", applyFilters);
      document.getElementById("priceRange").addEventListener("input", () => {
        document.getElementById("priceValue").textContent =
          priceRange.value + " EGP";
        applyFilters();
      });

      document.addEventListener("DOMContentLoaded", () => {
        renderProducts();
      });

      const sideBar = document.getElementById("sideBar");
      const toggler = document.querySelector(".sidebar-toggler");

      toggler.addEventListener("click", () => {
        sideBar.classList.toggle("closed");
      });
    </script>
  </body>
</html>
