<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Product</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f8f9fa;
      }
      .container {
        max-width: 700px;
      }
      .card {
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <div class="card p-4">
        <h2 class="mb-4">Add New Product</h2>
        <form id="addProductForm">
          <div class="mb-3">
            <label class="form-label">Product Name</label>
            <input type="text" id="productName" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Price (EGP)</label>
            <input
              type="number"
              id="productPrice"
              class="form-control"
              required
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Stock</label>
            <input
              type="number"
              id="productStock"
              class="form-control"
              required
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select id="productCategory" class="form-select" required>
              <option value="Living Room">Living Room</option>
              <option value="Bedroom">Bedroom</option>
              <option value="Dining Room">Dining Room</option>
              <option value="Office">Office</option>
              <option value="Outdoor">Outdoor</option>
              <option value="Lighting & Decor">Lighting & Decor</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Image URL</label>
            <input
              type="text"
              id="productImage"
              class="form-control"
              placeholder="assets/img.jpg"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary w-100">
            Add Product
          </button>
        </form>
        <div id="message" class="mt-3 text-success fw-bold"></div>
      </div>
    </div>

    <script>
      // Generate ID like p073, p074...
      function generateNewProductId() {
        const products = JSON.parse(localStorage.getItem("products")) || [];
        let maxId = 0;
        products.forEach((p) => {
          const num = parseInt(p.id.replace("p", ""), 10);
          if (!isNaN(num) && num > maxId) maxId = num;
        });
        const newNum = maxId + 1;
        return "p" + newNum.toString().padStart(3, "0");
      }

      document
        .getElementById("addProductForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const currentUser = JSON.parse(localStorage.getItem("currentUser"));
          if (!currentUser || currentUser.role !== "seller") {
            alert("You must be logged in as a seller to add products.");
            return;
          }

          const name = document.getElementById("productName").value.trim();
          const price = parseFloat(
            document.getElementById("productPrice").value
          );
          const stock = parseInt(document.getElementById("productStock").value);
          const category = document.getElementById("productCategory").value;
          const image = document.getElementById("productImage").value.trim();

          const newProduct = {
            id: generateNewProductId(),
            name,
            price,
            stock,
            category,
            images: [image],
            sellerId: currentUser.id,
            currency: "EGP",
          };

          let products = JSON.parse(localStorage.getItem("products")) || [];
          products.push(newProduct);
          localStorage.setItem("products", JSON.stringify(products));

          // also push to seller's products list
          let users = JSON.parse(localStorage.getItem("users")) || [];
          const sellerIndex = users.findIndex((u) => u.id === currentUser.id);
          if (sellerIndex !== -1) {
            users[sellerIndex].products = users[sellerIndex].products || [];
            users[sellerIndex].products.push(newProduct.id);
            localStorage.setItem("users", JSON.stringify(users));
          }

          document.getElementById("message").textContent =
            "âœ… Product added successfully!";
          this.reset();
        });
    </script>
  </body>
</html>
