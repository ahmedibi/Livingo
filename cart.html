<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shopping Cart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
    integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    
    .breadcrumb-nav {
      margin: 20px auto 30px;
      max-width: 1100px;
      font-size: 14px;
      color: #666;
    }

    .breadcrumb-nav a {
      text-decoration: none;
      color: gray;
      font-weight: 500;
    }

    .breadcrumb-nav a:hover {
      text-decoration: underline;
    }

    .breadcrumb-nav span {
      margin: 0 5px;
    }

    .breadcrumb-nav .active {
      color: black;
      font-weight: 600;
    }

    nav a.navbar-brand {
      color: black;
    }

    .table thead th {
      background-color: #a0804d !important;
      color: #fff !important;
    }

    .table th,
    .table td {
      vertical-align: middle !important;
    }

    .table td {
      border-top: 1px solid #dee2e6;
    }

    .product-info {
      text-align: left;
    }

    .product-image {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
    }

    .quantity-input {
      width: 60px;
    }

    .remove-btn {
      border: none;
      background: transparent;
      font-size: 1.5rem;
      color: crimson;
      cursor: pointer;
    }

    .remove-btn:hover {
      color: darkred;
    }

    


    
    .btn-outline {
      --bs-btn-color: #a0804d !important;
      --bs-btn-border-color: #a0804d !important;
      --bs-btn-hover-color: #fff !important;
      --bs-btn-hover-bg: black !important;
      --bs-btn-hover-border-color: black !important;
      --bs-btn-focus-shadow-rgb: 220, 53, 69;
      --bs-btn-active-color: #fff !important;
      --bs-btn-active-bg: black !important;
      --bs-btn-active-border-color: black !important;
      --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);

    }

    .btn-outline-secondary {
      --bs-btn-color: #a0804d !important;
      --bs-btn-border-color: #a0804d !important;
      --bs-btn-hover-color: #fff !important;
      --bs-btn-hover-bg: black !important;
      --bs-btn-hover-border-color: black !important;
      --bs-btn-focus-shadow-rgb: 220, 53, 69;
      --bs-btn-active-color: #fff !important;
      --bs-btn-active-bg: #a0804d !important;
      --bs-btn-active-border-color: #a0804d !important;
      --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    }
  </style>
</head>

<body>
  <div id="navbar"></div>

  


  
  <div class="container min-vh-100 my-5">
    
    <ul class="breadcrumb p-4">
      <li class="breadcrumb-item"><a href="index.html" class="small text-secondary text-decoration-none">Home</a></li>
      <li class="breadcrumb-item"><span class="active">Cart</span></li>


    </ul>

    <div class="table-responsive">
      <table class="table align-middle text-center">
        <thead>
          <tr>
            <th>Product Image</th>
            <th>Product Name</th>
            <th>Price</th>
            <th style="width: 180px;">Quantity</th>
            <th>Subtotal</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody id="cartItems">
          
        </tbody>
      </table>
    </div>

    <div class="row mt-4" id="cartActions">
      <div class="col-12 d-flex justify-content-between align-items-center flex-wrap">
        <div
          class="mb-3 mb-md-0 d-flex align-items-center justify-content-center justify-content-md-start col-12 col-md-6">
          <input type="text" id="coupon" class="form-control d-inline-block me-2 " style="width: 200px"
            placeholder="Coupon Code" />
          <button class="btn btn-outline" onclick="applyCoupon()">
            Apply Coupon
          </button>
        </div>
        <div
          class="d-flex flex-column flex-md-row align-items-center justify-content-center justify-content-md-end col-12 col-md-6 mt-5 mt-md-0"
          style="gap:10px">
          <button class="btn btn-outline  col-10 col-md-5 col-lg-auto mb-2 mb-md-0 " onclick="updateCart()">
            Update Cart
          </button>
          <button class="btn border border-0  col-10 col-md-5 col-lg-auto mb-2 mb-md-0"
            style="background: #a0804d;color:#fff" onclick="continueShopping()">
            Continue Shopping
          </button>
        </div>
      </div>
    </div>

    
    <div class="d-flex justify-content-center justify-content-md-end mt-4 mt-5">
      <div class="card shadow-sm" style="max-width: 350px; width: 100% ">
        <div class="card-body">
          <h5 class="card-title" style="color: black; font-weight: bolder">
            Cart Total
          </h5>
          <div class="d-flex justify-content-between">
            <span>Subtotal:</span>
             <strong> <span id="subtotal">0.00</span> <small>EGP</small> </strong>
          </div>
          <div class="d-flex justify-content-between">
            <span>Shipping:</span>
            <strong><span style="color:green">Free</span></strong>
          </div>
          <hr />
          <div class="d-flex justify-content-between fs-5">
            <span class="fw-bold">Total:</span>
              <strong><span id="total" class="fw-bold">0.00</span> <span class="small fw-bold fs-6">EGP</span></strong>
          </div>
          <button class="btn border border-0 w-100 mt-3" style="background: #a0804d;color:#fff"
            onclick="goToCheckout()">
            Proceed to Checkout
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="footer" class="mt-5"></div>

  <script>
  let cart = [];
const products = JSON.parse(localStorage.getItem("products")) || [];




function saveCart(cart) {
  let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
  if (currentUser) {
    currentUser.cart = cart;
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
  }
}


function loadCart() {
  let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
  return (currentUser && currentUser.cart) ? currentUser.cart : [];
}


function updateCartCount() {
  let cart = loadCart();
  const count = cart.reduce((sum, item) => sum + item.quantity, 0);
  const counterEl = document.getElementById("cart-count");
  if (counterEl) counterEl.innerText = count;
}


function updateQty(id, qty) {
  let cart = loadCart();
  const index = cart.findIndex((p) => p.id === id);
  if (index !== -1) {
    let newQty = parseInt(qty);

    
    const product = products.find(p => String(p.id) === String(id));
    if (product && newQty > product.stock) {
      alert(`âš  Only ${product.stock} items available in stock!`);
      newQty = product.stock;
    }

    if (newQty > 0) {
      cart[index].quantity = newQty;
    } else {
      cart.splice(index, 1);
    }
    saveCart(cart);
    renderCart();
    updateCartCount();
  }
}


function changeQuantity(id, newQty) {
  let cart = loadCart();
  const index = cart.findIndex((p) => p.id === id);

  if (index !== -1) {
    newQty = parseInt(newQty);

    if (isNaN(newQty) || newQty < 1) {
      newQty = 1; 
    }

    cart[index].quantity = newQty;

    saveCart(cart);
    renderCart();
    updateCartCount();
  }
}


function removeItem(id) {
  if (confirm("Are you sure you want to remove this item from your cart?")) {
    let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
    let users = JSON.parse(localStorage.getItem("users")) || [];

    if (currentUser && Array.isArray(currentUser.cart)) {
      currentUser.cart = currentUser.cart.filter((p) => p.id !== id);

      const userIndex = users.findIndex(u => u.id === currentUser.id);
      if (userIndex !== -1) {
        users[userIndex] = currentUser;
      }

      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      localStorage.setItem("users", JSON.stringify(users));
    }

    renderCart();
    updateCartCount();
  }
}


function renderCart() {
  cart = loadCart();
  const cartItemsContainer = document.getElementById("cartItems");
  let rows = "";
  let subtotal = 0;

  if (cart.length === 0) {
    document.getElementById("cartActions").style.display = "none";
    rows = `
      <tr>
        <td colspan="5" class="text-center py-5">
          <div class="text-muted">
            <div style="font-size: 3rem;">ðŸ›’</div>
            <h4 class="mt-3">Your cart is empty</h4>
            <p>Add some products to get started!</p>
            <button class="btn btn-outline-secondary" onclick="continueShopping()">Start Shopping</button>
          </div>
        </td>
      </tr>
    `;
  } else {
    document.getElementById("cartActions").style.display = "flex";
    cart.forEach((item) => {
      const itemSubtotal = item.price * item.quantity;
      subtotal += itemSubtotal;

      rows += `
        <tr>
          <td style="width: 300px;" class="align-middle">
            <div class="d-flex align-items-center justify-content-center d-image">
              <img src="../assets/${item.images}" 
                   alt="${item.name}" 
                   class="product-image me-3"
                   onclick="goToProductDetails('${item.id}')"
                   onerror="this.src='../assets/images/placeholder.jpg'">
            </div>
          </td>
          <td class="product-info">
            <div>
              <h6 class="mb-1" style="color:black">${item.name}</h6>
              <small class="text-muted" style="color:black">Product ID: ${item.id}</small>
            </div>
          </td>
          <td><strong class="text-danger">${item.price.toFixed(2)} EGP</strong></td>
          <td>
            <div class="d-flex justify-content-center align-items-center">
              <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity('${item.id}', ${item.quantity - 1})">-</button>
              <input type="number" min="1" value="${item.quantity}" 
                     class="form-control quantity-input mx-2 text-center"
                     onchange="updateQty('${item.id}', this.value)">
              <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity('${item.id}', ${item.quantity + 1})">+</button>
            </div>
          </td>
          <td><strong style="color:black">${itemSubtotal.toFixed(2)} EGP</strong></td>
          <td><button class="remove-btn" onclick="removeItem('${item.id}')"><i class="fa-solid fa-trash" style="font-size:16px"></i></button></td>
        </tr>
      `;
    });
  }

  cartItemsContainer.innerHTML = rows;
  document.getElementById("subtotal").innerText = subtotal.toFixed(2);
  document.getElementById("total").innerText = subtotal.toFixed(2);
}


function goToProductDetails(productId) {
  window.location.href = `product-details.html?id=${productId}`;
}


function goToCheckout() {
  const cart = loadCart();
  if (cart.length === 0) {
    alert("Your cart is empty! Add some products first.");
    return;
  }

  
  for (let item of cart) {
    const product = products.find(p => String(p.id) === String(item.id));
    if (product && item.quantity > product.stock) {
      alert(`âš  ${item.name} exceeds available stock. Only ${product.stock} left!`);
      return;
    }
  }

  window.location.href = "checkout.html";
}


function updateCart() {
  renderCart();
  alert("Cart updated successfully!");
}


function applyCoupon() {
  const couponCode = document.getElementById("coupon").value.trim();
  if (couponCode) {
    alert("Coupon functionality will be implemented soon!");
  } else {
    alert("Please enter a coupon code");
  }
}


function continueShopping() {
  window.location.href = "index.html";
}


document.addEventListener("DOMContentLoaded", () => {
  renderCart();
  updateCartCount();

  
  fetch("partials/navbar.html")
    .then((res) => res.text())
    .then((data) => {
      document.getElementById("navbar").innerHTML = data;
    })
    .catch((err) => console.error("Error loading navbar:", err));

  
  fetch("partials/footer.html")
    .then((res) => res.text())
    .then((data) => {
      document.getElementById("footer").innerHTML = data;
    })
    .catch((err) => console.error("Error loading footer:", err));
});

  </script>

  <script src="js/components.js"></script>
</body>

</html>